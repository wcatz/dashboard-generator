{{if .Error}}
<div class="p-4 text-sm text-error">{{.Error}}</div>
{{else}}
{{with .Panel}}
<div class="p-5">
  <div class="flex justify-between items-start mb-4">
    <div>
      <span class="badge badge-sm type-badge-{{.Type}}">{{.Type}}</span>
      <h3 class="text-base font-semibold mt-1">{{.Title}}</h3>
      {{if .Description}}<p class="text-xs text-base-content/50 mt-1">{{.Description}}</p>{{end}}
    </div>
    <button class="btn btn-ghost btn-xs" onclick="closePanelDetail()">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
    </button>
  </div>

  <div class="space-y-4">
    <!-- Grid position -->
    <div>
      <div class="text-[0.65rem] uppercase tracking-wider text-base-content/50 font-semibold mb-1">layout</div>
      <div class="flex flex-wrap gap-2 text-xs">
        <span class="badge badge-sm badge-outline">{{.W}} x {{.H}}</span>
        <span class="badge badge-sm badge-ghost">pos ({{.X}}, {{.Y}})</span>
        {{if .Section}}<span class="badge badge-sm badge-ghost">{{.Section}}</span>{{end}}
      </div>
    </div>

    <!-- Datasource -->
    {{if .Datasource}}
    <div>
      <div class="text-[0.65rem] uppercase tracking-wider text-base-content/50 font-semibold mb-1">datasource</div>
      <span class="badge badge-sm badge-info">{{.Datasource}}</span>
    </div>
    {{end}}

    <!-- Unit -->
    {{if .Unit}}
    <div>
      <div class="text-[0.65rem] uppercase tracking-wider text-base-content/50 font-semibold mb-1">unit</div>
      <span class="text-xs font-mono">{{.Unit}}</span>
    </div>
    {{end}}

    <!-- Queries -->
    {{if .Queries}}
    <div>
      <div class="text-[0.65rem] uppercase tracking-wider text-base-content/50 font-semibold mb-1">queries</div>
      <div class="space-y-2">
        {{range .Queries}}
        <div class="bg-base-200 border border-base-content/10 rounded-md p-3">
          <div class="flex items-center gap-2 mb-1">
            <span class="badge badge-xs badge-primary">{{.RefID}}</span>
            {{if .Legend}}<span class="text-[0.65rem] text-base-content/40">legend: {{.Legend}}</span>{{end}}
            {{if .Datasource}}<span class="badge badge-xs badge-ghost">{{.Datasource}}</span>{{end}}
          </div>
          <pre class="text-xs font-mono text-base-content/80 whitespace-pre-wrap break-all leading-relaxed">{{.Expr}}</pre>
        </div>
        {{end}}
      </div>
    </div>
    {{end}}

    <!-- Thresholds -->
    {{if .Thresholds}}
    <div>
      <div class="text-[0.65rem] uppercase tracking-wider text-base-content/50 font-semibold mb-1">thresholds</div>
      <div class="flex gap-0.5 h-5 rounded overflow-hidden mb-1">
        {{range .Thresholds}}
        <div class="flex-1" style="background: {{.Color}};" title="{{.Color}} @ {{.Value}}"></div>
        {{end}}
      </div>
      <div class="flex flex-wrap gap-2">
        {{range .Thresholds}}
        <span class="text-[0.6rem] font-mono text-base-content/50">
          <span class="inline-block w-2 h-2 rounded-full mr-0.5" style="background: {{.Color}};"></span>
          {{.Value}}
        </span>
        {{end}}
      </div>
    </div>
    {{end}}
  </div>
</div>
{{end}}
{{end}}
