{{define "content"}}
<h1 class="text-xl font-bold mb-1">color palettes</h1>
<p class="text-sm text-base-content/50 mb-6">active palette: <strong>{{.ActivePalette}}</strong></p>

<!-- Create new palette -->
<div class="card bg-base-100 border border-base-content/10 mb-4">
  <div class="card-body p-4">
    <form class="flex gap-2 items-end" hx-post="/api/palette/create" hx-target="#palette-cards" hx-swap="innerHTML">
      <label class="form-control flex-1">
        <div class="label"><span class="label-text text-xs">new palette</span></div>
        <input type="text" name="name" placeholder="palette name" class="input input-bordered input-sm w-full" required>
      </label>
      <button type="submit" class="btn btn-sm btn-primary">create</button>
    </form>
  </div>
</div>

<!-- Palette cards (HTMX swap target for all mutations) -->
<div id="palette-cards">
  {{range $name, $colors := .Palettes}}
  <div class="card bg-base-100 border border-base-content/10 mb-4">
    <div class="card-body p-5">
      <div class="flex items-center gap-2 mb-3">
        <h3 class="card-title text-sm flex-1">
          {{$name}}
          {{if eq $name $.ActivePalette}}<span class="badge badge-sm badge-success ml-1">active</span>{{end}}
        </h3>
        {{if ne $name $.ActivePalette}}
        <button class="btn btn-xs btn-ghost" title="set as active palette"
          hx-post="/api/palette/activate" hx-vals='{"name":"{{$name}}"}' hx-target="#palette-cards" hx-swap="innerHTML">
          activate
        </button>
        {{end}}
        <button class="btn btn-xs btn-ghost btn-error" title="delete palette"
          hx-post="/api/palette/delete" hx-vals='{"name":"{{$name}}"}' hx-target="#palette-cards" hx-swap="innerHTML"
          hx-confirm="delete palette '{{$name}}'?">
          delete
        </button>
      </div>

      <div class="flex flex-wrap gap-3 items-end">
        {{range $color, $hex := $colors}}
        <div class="text-center group">
          <div class="relative w-12 h-12">
            <div class="w-12 h-12 rounded-md border border-base-content/10 group-hover:scale-110 transition-transform cursor-pointer" style="background: {{$hex}};" onclick="this.nextElementSibling.click()" title="click to change color"></div>
            <input type="color" value="{{$hex}}" class="absolute inset-0 opacity-0 w-full h-full cursor-pointer"
              onchange="paletteSetColor('{{$name}}', '{{$color}}', this.value)">
          </div>
          <div class="text-[0.65rem] mt-1 opacity-50 cursor-pointer hover:text-primary" onclick="paletteRenameColor('{{$name}}', '{{$color}}')" title="click to rename">{{$color}}</div>
          <div class="flex items-center justify-center gap-0.5">
            <span class="text-[0.6rem] font-mono text-base-content/60 cursor-pointer hover:text-primary" onclick="copyHex(this.textContent)" title="click to copy">{{$hex}}</span>
            <button class="btn btn-xs btn-ghost btn-circle opacity-0 group-hover:opacity-50 hover:!opacity-100 !h-4 !w-4 !min-h-0" title="delete color"
              hx-post="/api/palette/color/delete" hx-vals='{"palette":"{{$name}}","color":"{{$color}}"}' hx-target="#palette-cards" hx-swap="innerHTML">
              &#215;
            </button>
          </div>
        </div>
        {{end}}

        <!-- Add color button -->
        <div class="text-center">
          <button class="w-12 h-12 rounded-md border-2 border-dashed border-base-content/20 hover:border-primary flex items-center justify-center cursor-pointer transition-colors" onclick="paletteAddColor('{{$name}}')" title="add color">
            <span class="text-lg text-base-content/30">+</span>
          </button>
          <div class="text-[0.65rem] mt-1 opacity-30">add</div>
        </div>
      </div>
    </div>
  </div>
  {{end}}

  <!-- Threshold presets (read-only) -->
  <div class="card bg-base-100 border border-base-content/10">
    <div class="card-body p-5">
      <h3 class="card-title text-sm">threshold presets</h3>
      {{range $name, $steps := .Thresholds}}
      <div class="mb-3">
        <div class="text-sm font-semibold mb-1">${{$name}}</div>
        <div class="flex gap-0.5 h-6 rounded overflow-hidden">
          {{range $steps}}
          <div class="flex-1 cursor-pointer" style="background: {{.Color}};" title="{{.Color}} @ {{.Value}}" onclick="copyHex('{{.Color}}')"></div>
          {{end}}
        </div>
      </div>
      {{end}}
    </div>
  </div>
</div>
{{end}}
