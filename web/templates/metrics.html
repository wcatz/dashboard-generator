{{define "content"}}
<h1>metric browser</h1>
<p class="subtitle">browse and search metrics from connected datasources</p>

<div class="card">
  <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
    <label style="font-size: 0.85rem; cursor: pointer; display: flex; align-items: center; gap: 0.4rem;">
      <input type="checkbox" id="compare-toggle" style="width: auto; margin: 0;">
      comparison mode
    </label>
  </div>

  <form id="browse-form" hx-get="/api/metrics/browse" hx-target="#metrics-result" hx-indicator="#metrics-spinner">
    <div style="display: flex; gap: 0.75rem; align-items: end; flex-wrap: wrap;">
      <label style="flex: 1; min-width: 150px;">
        datasource
        <select name="datasource" id="ds-select" hx-get="/api/metrics/jobs" hx-target="#job-tabs" hx-trigger="change" hx-include="[name='datasource']">
          {{range $name, $ds := .Datasources}}
          {{if $ds.URL}}<option value="{{$name}}">{{$name}}</option>{{end}}
          {{end}}
        </select>
      </label>
      <label id="ds-b-container" style="flex: 1; min-width: 150px; display: none;">
        compare with
        <select name="datasource_b" id="ds-b-select">
          {{range $name, $ds := .Datasources}}
          {{if $ds.URL}}<option value="{{$name}}">{{$name}}</option>{{end}}
          {{end}}
        </select>
      </label>
      <label style="flex: 2; min-width: 200px;">
        filter (glob pattern)
        <input type="text" name="filter" placeholder="node_* or *_total" value="{{.Filter}}">
      </label>
      <label style="min-width: 120px;">
        type
        <select name="type">
          <option value="">all types</option>
          <option value="counter">counter</option>
          <option value="gauge">gauge</option>
          <option value="histogram">histogram</option>
          <option value="summary">summary</option>
        </select>
      </label>
      <button type="submit">
        browse <span id="metrics-spinner" class="htmx-indicator"><span class="spinner"></span></span>
      </button>
    </div>
  </form>
</div>

<div id="job-tabs"></div>

<div id="metrics-result">
  {{if .HasDatasources}}
  <div class="empty-state">
    <p>select a datasource and click browse</p>
  </div>
  {{else}}
  <div class="empty-state">
    <p>no datasources with URLs configured</p>
    <p>set a URL on the <a href="/datasources">datasources page</a> first</p>
  </div>
  {{end}}
</div>
{{end}}
